var EmailUserObject={captchaId:"",setCaptchaId:function(captchaId){this.captchaId=captchaId},sendVerifyCode:function(email,type){const xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE)if(xhr.status===200){var res=JSON.parse(xhr.response);if(!res){common.showHint("error","获取验证码失败，请稍后再试");return}if(res.code!=200){common.showHint("error",res.message);return}common.showHint("success","发送验证码成功")}else common.showHint("error","获取验证码失败，请稍后再试")};const url=common.baseUrl+"/api/v2/user/sendRegUserCode";type||(type=0);const params={email,type},jsonParams=JSON.stringify(params);xhr.open("POST",url),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(jsonParams)},reg:function(username,email,password,code){const xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE){if(xhr.status===200){var res=JSON.parse(xhr.response);if(res.code===200){common.showHint("success","注册成功"),window.location.href="/email/login";return}common.showHint("warning",res.message);return}common.showHint("error","注册失败，请稍后再试")}};const url=common.baseUrl+"/api/v2/user/reg",params={username,email,password,code},jsonParams=JSON.stringify(params);xhr.open("POST",url),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(jsonParams)},login:function(){let email=document.getElementById("email").value,password=document.getElementById("password").value;if(!common.checkEmail(email))return common.showHint("warning","请输入正确邮箱"),!1;let validCode=document.getElementById("validCode").value;if(validCode==="")return common.showHint("warning","请输入验证码"),!1;let data={email,password,captchaId:EmailUserObject.captchaId,code:validCode};var xhr=new XMLHttpRequest;xhr.open("POST",common.baseUrl+"/api/v2/user/login",!0),xhr.send(JSON.stringify(data)),xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200&&xhr.response){var res=JSON.parse(xhr.response);if(res.code==200){localStorage.setItem("user_uuid",res.data.user_uuid),common.showHint("success","登录成功"),window.location.href="/";return}EmailUserObject.refreshCode(),common.showHint("warning",res.message)}}},refreshCode:function(){const xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE){if(xhr.status===200){var res=JSON.parse(xhr.response);if(res.code===200){EmailUserObject.captchaId=res.data,document.getElementById("verify-code").src="/verify/image/"+EmailUserObject.captchaId+".png";return}common.showHint("warning",res.message);return}common.showHint("error","注册失败，请稍后再试")}};const url=common.baseUrl+"/verify/name";xhr.open("GET",url),xhr.setRequestHeader("Content-Type","application/json"),xhr.send()},modify:function(email,password,code){const xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE){if(xhr.status===200){var res=JSON.parse(xhr.response);if(res.code===200){common.showHint("success","重置密码成功"),window.location.href="/email/login";return}common.showHint("warning",res.message);return}common.showHint("error","重置密码失败，请稍后再试")}};const url=common.baseUrl+"/api/v2/user/forget",params={email,password,code},jsonParams=JSON.stringify(params);xhr.open("POST",url),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(jsonParams)}}